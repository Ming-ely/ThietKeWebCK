<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Thanh toán sách - Chuyên nghiệp</title>
<style>
body{margin:0;font-family:Inter,Arial,sans-serif;background:#f0f2f5;color:#333}
.container{max-width:1024px;margin:auto;padding:20px}
h1{text-align:center;margin-bottom:20px}
.order{display:grid;grid-template-columns:1fr 350px;gap:20px}
.items,.summary{background:#fff;padding:20px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
.items h2,.summary h2{margin-top:0}
.item-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #eee}
.item-row:last-child{border:none}
input[type=number],select,input{padding:8px;border-radius:8px;border:1px solid #ddd;width:100%}
input[type=number]{width:80px}
.line{display:flex;justify-content:space-between;padding:6px 0}
.total{font-weight:700;border-top:1px dashed #eee;padding-top:12px;margin-top:8px}
.pay{width:100%;padding:12px;border-radius:10px;background:#0078ff;color:#fff;border:0;font-size:16px;margin-top:12px;cursor:pointer}
.hint{font-size:13px;color:#666;margin-top:4px}
.hidden{display:none}
.toast{position:fixed;right:20px;bottom:20px;background:#333;color:#fff;padding:12px 16px;border-radius:8px;opacity:0;transition:0.3s;z-index:1000}
.toast.show{opacity:1}
</style>
</head>
<body>
<main class="container">
  <h1>Thanh toán - Mua sách</h1>
  <section class="order">
    <div class="items">
      <h2>Giỏ hàng</h2>
      <div class="item-row">
        <div><b>Giá sách:</b> <span id="bookPrice">120000</span> ₫</div>
        <div>Số lượng: <input id="qty" type="number" min="1" value="1"></div>
      </div>

      <label><b>Phương thức vận chuyển</b></label>
      <select id="shippingMethod">
        <option value="standard" data-fee="25000">Tiêu chuẩn - 25.000₫</option>
        <option value="express" data-fee="45000">Nhanh - 45.000₫</option>
        <option value="cod" data-fee="30000">COD - 30.000₫</option>
      </select>

      <label><b>Voucher</b></label>
      <input id="voucherCode" placeholder="BOOK10 / SHIP50 / FREESHIP">
      <button id="applyVoucher" class="pay" style="margin-top:8px">Áp dụng</button>
      <p class="hint">Mã hợp lệ: BOOK10(10%), SHIP50(50% phí vận chuyển tối đa 30k), FREESHIP(miễn phí vận chuyển)</p>
    </div>

    <aside class="summary">
      <h2>Tổng tiền</h2>
      <div class="line"><span>Tiền sách</span><span id="subTotal">0 ₫</span></div>
      <div class="line"><span>Chiết khấu voucher</span><span id="discount">0 ₫</span></div>
      <div class="line"><span>Phí vận chuyển</span><span id="shippingFee">0 ₫</span></div>
      <div class="line total"><span>Tổng phải trả</span><span id="grandTotal">0 ₫</span></div>

      <label><b>Phương thức thanh toán</b></label>
      <select id="paymentMethod">
        <option value="card">Thẻ tín dụng / Thẻ ghi nợ</option>
        <option value="bank">Chuyển khoản ngân hàng</option>
        <option value="momo">Ví điện tử (MOMO)</option>
      </select>

      <div id="bankList" class="hidden">
        <label>Chọn ngân hàng</label>
        <select id="bankSelect">
          <option value="vcb">Vietcombank</option>
          <option value="tech">Techcombank</option>
          <option value="acb">ACB</option>
          <option value="vietin">VietinBank</option>
          <option value="bidv">BIDV</option>
          <option value="tpb">TPBank</option>
          <option value="mb">MB</option>
          <option value="scb">SCB</option>
          <option value="vpbank">VPBank</option>
          <option value="shb">SHB</option>
        </select>
      </div>
      <button id="payBtn" class="pay">Xác nhận & Thanh toán</button>
    </aside>
  </section>

  <div id="toast" class="toast"></div>
</main>

<script>
const MIN_SHIPPING_FEE=30000;
const vouchers={
  BOOK10:{type:'percent',value:10},
  SHIP50:{type:'ship-percent',value:50,max:30000},
  FREESHIP:{type:'free-ship',value:100}
};

const el=id=>document.getElementById(id);
let appliedVoucher=null;

function money(x){return x.toLocaleString('vi-VN')+' ₫';}
function showToast(msg){const t=el('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}

function calc(){
  const price=Number(el('bookPrice').textContent);
  const qty=Math.max(1,Number(el('qty').value));
  const base=price*qty;
  let ship=Number(el('shippingMethod').selectedOptions[0].dataset.fee);
  let disc=0;
  if(appliedVoucher){
    const v=appliedVoucher;
    if(v.type==='percent') disc=Math.round(base*v.value/100);
    if(v.type==='ship-percent') ship=Math.max(0,ship-Math.min(Math.round(ship*v.value/100),v.max||ship));
    if(v.type==='free-ship') ship=0;
  }
  if(ship>0 && ship<MIN_SHIPPING_FEE) ship=MIN_SHIPPING_FEE;
  el('subTotal').textContent=money(base);
  el('discount').textContent=disc?'-'+money(disc):money(0);
  el('shippingFee').textContent=money(ship);
  el('grandTotal').textContent=money(base-disc+ship);
  return {total:base-disc+ship};
}

el('qty').addEventListener('input',calc);
el('shippingMethod').addEventListener('change',calc);
el('applyVoucher').addEventListener('click',()=>{
  const code=el('voucherCode').value.trim().toUpperCase();
  if(!vouchers[code]) return showToast('Mã voucher không hợp lệ');
  appliedVoucher=vouchers[code];
  showToast('Áp dụng '+code);
  calc();
});
el('paymentMethod').addEventListener('change',()=>{el('bankList').classList.toggle('hidden',el('paymentMethod').value!=='bank');});

el('payBtn').addEventListener('click',()=>{
  const {total}=calc();
  const pm=el('paymentMethod').value;
  if(pm==='bank'){ showToast('Chuyển khoản ngân hàng: '+el('bankSelect').value.toUpperCase()+' - Số tiền: '+total.toLocaleString('vi-VN')+' ₫'); }
  else if(pm==='card'){ showToast('Chuyển sang cổng thẻ - Tổng: '+total.toLocaleString('vi-VN')+' ₫'); }
  else{ showToast('Ví điện tử - Tổng: '+total.toLocaleString('vi-VN')+' ₫'); }
});

calc();
</script>
</body>
</html>
